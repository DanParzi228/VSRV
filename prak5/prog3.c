/* ---------------------------------------------------- */
/* ИМЯ: Фролов Даниил */
/* СРОК: 25/09/2025 */
/* НАЗНАЧЕНИЕ ПРОГРАММЫ: Практическая работа №5 */
/* ИМЯ ФАЙЛА: prog3.c */
/* НАЗНАЧЕНИЕ ПРОГРАММЫ: */
/* Динамический 1D-массив, 2D-массив и функция удаления строчных букв (вариант 16) */
/* ---------------------------------------------------- */

#include <stdio.h>
#include <stdlib.h>
#include <ctype.h>
#include <string.h>

/* ---------------------------------------------------- */
/* ФУНКЦИЯ one_d_array: Динамический 1D-массив */
/* НАЗНАЧЕНИЕ: Выделяет, заполняет, анализирует адреса 1D-массива */
/* ---------------------------------------------------- */
void one_d_array() {
    int N = 5;  /* Размер массива */
    int *arr = (int *)malloc(N * sizeof(int));  /* Выделение памяти */

    if (arr == NULL) {
        printf("Ошибка выделения памяти для 1D-массива\n");
        return;
    }

    /* Заполнение и вывод значений/адресов */
    printf("1D-массив:\n");
    for (int i = 0; i < N; i++) {
        arr[i] = i + 1;
        printf("Элемент %d: значение = %d, адрес = %p\n", i, arr[i], (void *)&arr[i]);
    }

    /* Анализ адресов */
    printf("Разница адресов между arr[0] и arr[1]: %ld байт\n\n", (long)(&arr[1] - &arr[0]));

    free(arr);  /* Освобождение памяти */
}

/* ---------------------------------------------------- */
/* ФУНКЦИЯ two_d_array: Динамический 2D-массив */
/* НАЗНАЧЕНИЕ: Выделяет, заполняет, анализирует адреса 2D-массива */
/* ---------------------------------------------------- */
void two_d_array() {
    int N = 3, M = 4;  /* Размеры */
    int **arr = (int **)malloc(N * sizeof(int *));  /* Указатели на строки */

    if (arr == NULL) {
        printf("Ошибка выделения памяти для 2D-массива\n");
        return;
    }

    for (int i = 0; i < N; i++) {
        arr[i] = (int *)malloc(M * sizeof(int));  /* Выделение строки */
        if (arr[i] == NULL) {
            printf("Ошибка выделения памяти для строки %d\n", i);
            for (int j = 0; j < i; j++) free(arr[j]);
            free(arr);
            return;
        }
    }

    /* Заполнение и вывод значений/адресов */
    printf("2D-массив:\n");
    for (int i = 0; i < N; i++) {
        for (int j = 0; j < M; j++) {
            arr[i][j] = i * M + j + 1;
            printf("Элемент [%d][%d]: значение = %d, адрес = %p\n", i, j, arr[i][j], (void *)&arr[i][j]);
        }
    }

    /* Анализ адресов */
    printf("Адрес arr[0]: %p, arr[1]: %p\n", (void *)arr[0], (void *)arr[1]);
    printf("Разница между arr[0][0] и arr[0][1]: %ld байт\n\n", (long)(&arr[0][1] - &arr[0][0]));

    /* Освобождение */
    for (int i = 0; i < N; i++) free(arr[i]);
    free(arr);
}

/* ---------------------------------------------------- */
/* ФУНКЦИЯ remove_lowercase: Удаляет строчные буквы из строки */
/* НАЗНАЧЕНИЕ: Модифицирует str на месте, возвращает новую длину, */
/* через *count возвращает количество удалённых букв */
/* ---------------------------------------------------- */
int remove_lowercase(char *str, int *count) {
    int len = strlen(str);
    int removed = 0;
    int i = 0;

    while (i < len) {
        if (islower(str[i])) {
            memmove(&str[i], &str[i + 1], len - i);  /* Сдвиг символов влево */
            removed++;
            len--;
        } else {
            i++;
        }
    }

    *count = removed;
    return len;  /* Новая длина строки */
}

int main() {
    // Выполнение 1D-массива
    one_d_array();

    // Выполнение 2D-массива
    two_d_array();

    // Выполнение варианта 16 с вводом строки с клавиатуры
    char *str = (char *)malloc(100 * sizeof(char));  /* Выделение памяти */
    int count;
    int new_len;

    if (str == NULL) {
        printf("Ошибка выделения памяти для строки\n");
        return 1;
    }

    /* Ввод строки с клавиатуры */
    printf("Введите строку (максимум 99 символов): ");
    if (fgets(str, 100, stdin) != NULL) {
        /* Удаление символа новой строки, если он есть */
        size_t len = strlen(str);
        if (len > 0 && str[len - 1] == '\n') {
            str[len - 1] = '\0';
        }
    } else {
        printf("Ошибка ввода строки\n");
        free(str);
        return 1;
    }

    /* Объявление указателя на функцию */
    int (*fptr)(char *, int *) = remove_lowercase;

    /* Вызов функции через указатель */
    new_len = fptr(str, &count);

    /* Вывод результатов */
    printf("Вариант 16:\n");
    printf("Modified string: %s\n", str);
    printf("Removed lowercase letters: %d\n", count);
    printf("New length: %d\n\n", new_len);

    /* Освобождение памяти */
    free(str);

    return 0;
}
